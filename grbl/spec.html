<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>grblくんのプロトコルっぽい部分</title>
    <link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body class="dark">
<div id="wrapper">
    <h1>grblくんのプロトコルっぽい部分</h1>
<p>TypeScript向けに必要そうな箇所だけ抜いたインターフェイスを書いてます。</p>
<p>パブリックな場所に置くとDCMA受けそうな予感がするので公開はしません。変数名にも著作権があるという点は否定しないので、こればっかりはすみません。</p>
<p>ただまあ、私の知り合いに私的利用の範囲で見せる程度ならグレーだと思うので、気になる人は声かけてください。</p>
<h2>初期値</h2>
<p>ページを開いたときに取ってくる色んな情報。<code>start.json</code>くんです</p>
<p>なぜか他プレイヤーのHPとか取れる。どうして……？　あとlyriaの存在をチェックする変数がある。尊い。</p>
<h3>raidid</h3>
<p>urlで/#raid_multi/{raid_id}となるやつ。少なくとも各プレイヤーにおいてはユニークだと思って良さそう。</p>
<h3>player</h3>
<p>プレイヤーの編成。player.paramがArrayになっていて、nameとかhpmaxあたりが取れる。</p>
<h3>summon</h3>
<p>召喚石。nameとかrecast、requireあたりが取れる。</p>
<h2>通常攻撃</h2>
<p>通常攻撃は皆さんご存知の通り<code>normal_attack_result.json</code>で処理されています</p>
<p>scenarioの中のcmdが何をしているかの指定になっています。下記にざっくりわかったところを書きます。あんまいらなさそうなところは書きません。</p>
<h3>scenario内cmdリスト</h3>
<h4>condition</h4>
<p>おそらく表示上の調整。攻撃ボタンを押してからバフ・デバフが付いたように見えるのはこの処理があるから。</p>
<p>あとは奥義効果とかもこれで付与されてるっぽい。</p>
<h4>wait</h4>
<p>同上。攻撃ボタンを押してバフ・デバフなどを調整したあとごく短時間のウェイトがかかっているのはこれによる。</p>
<h4>attack</h4>
<p>通常攻撃。damage: Array&lt;Array&lt;Object&gt;&gt;がキモで、連撃と追撃をここで解決している。</p>
<p>ちなみに敵からの攻撃も同一のこのコマンドから発生している。</p>
<h4>special_npc</h4>
<p>おそらく奥義と思われる。トータルには表示用の文字列しかないので、計算にはlist(Array)をforEachして<code>list[i].damage[0].value</code>がいいんじゃないかな。</p>
<p>ちょっとtotalもそうだけど、なぜArrayになっているかわからないので、キャラクターによって変わることを踏まえて二重forEachにしていい気もする。</p>
<h4>recast</h4>
<p>おそらく奥義ゲージの蓄積を示しているっぽい。</p>
<h4>modechange</h4>
<p>敵のモードゲージ。%で見れるけど手元だとそこまで細かく見えないのでかき消す予定。</p>
<h4>heal</h4>
<p>吸収とかによる回復。</p>
<h4>ability</h4>
<p>トリガ系とかこれで発動する。</p>
<h4>damage</h4>
<p>奥義追加ダメージとかがこれに当たるっぽい。誰が打ったのか情報を持っていないので、コンテキストから判断するしかないかも……？</p>
<p>構造はhealとほぼ同じで、インターフェイス流用している感じがすごい。</p>
<h2>アビリティ</h2>
<p>実　家　の　よ　う　な　<code>a　b　i　l　i　t　y　_　r　e　s　u　l　t　.　j　s　o　n</code></p>
<p>はい。こいつはクソ厄介です。なぜかというとscenarioが奇怪な動きをするからです……。</p>
<p>
    scenarioはnormal_attack_result.jsonのようにArrayで、新しく発動したアビリティが[0]側にあるんですけど、途中に空のArrayが挟み込まれ、それ以降にいつのだかわからないコマンドが出現します。</p>
<p>なんとなく見た感じだとstatusっぽいんですけど、statusは別にあるんですよね……マジで謎。</p>
<p>あと、誰が打ったかはposで確認できるんですけど、何個目のアビかは判断できないので、リキャは別途statusから引っ張るしかなさそう。</p>
<p>ざっくり見た感じだけど、cmd: damage, healさえ追跡すれば誰がどれくらいの値を出したか確認できるっぽい。</p>

    <script src="../theme.js"></script>
</div>
</body>
</html>
